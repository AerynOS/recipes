name        : boulder
version     : 1.0.1
release     : 36
summary     : Package creation tool for Serpent OS
license     : Zlib
homepage    : https://github.com/serpent-os/boulder
description : |
    Extremely flexible and powerful, yet simple to use, package build
    tool for the Serpent OS project.
upstreams   :
    - git|https://github.com/serpent-os/boulder : ff85ed1bdd9c0a7398daf65d779640930ee867a9
    - https://github.com/serpent-os/libmoss/archive/refs/tags/v1.2.1.tar.gz :
        hash: cafae1ed6f225cde5961ee70378fee289bea80aedc4cd3b5b043b7f32d163f51
        unpackdir: libmoss
        stripdirs: 1
builddeps   :
    - binary(cmake)
    - ldc
    - ldc-devel
    - lmdb-devel
    - pkgconfig(dbus-1)
    - pkgconfig(libcurl)
    - pkgconfig(libxxhash)
    - pkgconfig(libzstd)
rundeps     :
    - binary(moss-container)
environment : |
    cd %(buildroot)/boulder
setup       : |
    # TODO: Unset buildtype here when moss-format supports DFLAGS
    export DFLAGS="$DFLAGS -flto=thin -O3 -g"
    %meson --buildtype debugoptimized
build       : |
    %meson_build
install     : |
    %meson_install
    ln -sf boulder %(installroot)/usr/bin/mason

    %install_dir %(installroot)/usr/share/moss
    mv data/macros %(installroot)/usr/share/moss/
