#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : python-pip
version     : "25.2"
release     : 4
homepage    : https://pip.pypa.io/
upstreams   :
    - https://pypi.debian.net/pip/pip-25.2.tar.gz : 578283f006390f85bb6282dffb876454593d637f5d1be494b5202ce4877e71f2
summary     : The PyPA recommended tool for installing Python packages
description : |
    The PyPA recommended tool for installing Python packages
license     : MIT
builddeps   :
    - python(myst-parser)
    - python(setuptools)
    - python(sphinx)
    - python(sphinx-copybutton)
    - python(sphinx-inline-tabs)
    - python(sphinx-issues)
rundeps     :
    - binary(python3)
    - python(attrs)
    - python(cryptography)
    - python(filelock)
    - python(wheel)
# TODO: Needs a chunk of deps for tests
# checkdeps   :
#     - python(pytest)
setup       : |
    # Towncrier is broken and not needed for man pages
    sed '/towncrier/d' -i docs/html/conf.py
build       : |
    %pyproject_build

    # Build man pages
    export PYTHONPATH="$PWD/src"
    cd docs
    python pip_sphinxext.py
    sphinx-build -b man -d build/doctrees/man man build/man -c html
install     : |
    %pyproject_install

    # Generate shell completions
    _site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
    PYTHONPATH=%(installroot)/$_site_packages %(installroot)%(bindir)/pip completion --bash | %install_file /dev/stdin %(installroot)%(bashcompletionsdir)/pip
    PYTHONPATH=%(installroot)/$_site_packages %(installroot)%(bindir)/pip completion --zsh | tail -n+3 | %install_file /dev/stdin %(installroot)%(zshcompletionsdir)/_pip
    PYTHONPATH=%(installroot)/$_site_packages %(installroot)%(bindir)/pip completion --fish | %install_file /dev/stdin %(installroot)%(fishcompletionsdir)/pip.fish

    # Install man pages
    %install_file docs/build/man/*.1 -t %(installroot)%(mandir)/man1
# check       : |
#     # TODO replace with pytest macro
#     PYTHONPATH="$PWD"/build/lib pytest
