#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : python-certifi
# This is frequently updated but virtually all updates are just updating the bundled cacert.pem file.
#  We however modify this package so it uses the system certificates instead and not the bundled certs. Thus
#  most updates are useless, you should just compare the version tags and if the only thing that have changed
#  are the version string and cacert.pem file then you can skip the update.
version     : 2025.08.03
release     : 2
homepage    : https://github.com/certifi/python-certifi
upstreams   :
    - https://github.com/certifi/python-certifi/archive/refs/tags/2025.08.03.tar.gz : fdbe80c4c92fc99449759a62e06508667eabbdb04f1ace6010b88028de8d2c97
summary     : Python package for providing Mozilla's CA Bundle
description : |
    Certifi is a carefully curated collection of Root Certificates for validating the trustworthiness of SSL certificates while verifying the identity of TLS hosts. It has been extracted from the Requests project.
license     : LGPL-3.0-or-later
builddeps   :
    - python(setuptools)
rundeps     :
    - python-libs
checkdeps   :
    - python(pytest)
setup       : |
    # Use system CA store. Replacing the copy in the source tree so the test
    # suite is actually run against it.
    ln -sf /etc/ssl/certs/ca-certificates.crt certifi/cacert.pem

    # Our CA store has non-ASCII comments, but we are not packaging for JVM
    # https://github.com/certifi/python-certifi/issues/50
    sed -i 's/encoding="ascii"/encoding="utf-8"/' certifi/core.py
build       : |
    %pyproject_build
install     : |
    %pyproject_install

    # Replace CA store here again because the symlink was installed as a file
    _site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
    ln -sf ../../../../../etc/ssl/certs/ca-certificates.crt %(installroot)/${_site_packages}/certifi/cacert.pem
check       : |
    # TODO replace with pytest macro
    PYTHONPATH="$PWD"/build/lib pytest
