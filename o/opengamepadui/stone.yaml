#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : opengamepadui
version     : "0.44.2"
release     : 24
homepage    : https://github.com/ShadowBlip/OpenGamepadUI
upstreams   :
    - https://github.com/ShadowBlip/OpenGamepadUI/archive/refs/tags/v0.44.2.tar.gz : 1337b170b2990fb75d6f3b02db979bb4d6bc51ac3d96daaef1ef9f2b17b4af6b
summary     : Open source gamepad-native game launcher and overlay
description : |
    Open Gamepad UI is a free and open source game launcher and overlay written using the Godot Game Engine 4 designed with a gamepad native experience in mind.
    Its goal is to provide an open and extendable foundation to launch and play games. It also implements a gamepad input system that can allow you to remap
    gamepad input to mouse and keyboard inputs.
license     : GPL-3.0-or-later
networking  : true
builddeps   :
    - binary(cargo)
    - binary(godot)
    - binary(unzip)
    - binary(wget)
    - pkgconfig(fontconfig)
    - sysbinary(setcap)
rundeps     :
    - binary(brightnessctl)
    - binary(glxinfo)
    - binary(inputplumber)
    - binary(vulkaninfo)
environment : |
    export PATH="/usr/bin:/usr/sbin"
setup       : |
    # Workaround to have decent default settings. We need to create a new platform on OGUI
    %patch %(pkgdir)/use-chimeraos-defaults.patch
    # Enables OGUI to start properly
    %patch %(pkgdir)/fix-prefix.patch
    # Be more verbose to be able to debug better
    %patch %(pkgdir)/debug.patch
    # Currently '-steamos3' flag is preventing 'steam' to be launched on AerynOS.
    # Additionally we enable more options in overlaymode to compensate missing features
    # of GamepadUI which SteamDeck mode would provide.
    %patch %(pkgdir)/aerynos.patch

    cd extensions
    %cargo_fetch
build       : |
    %make
install     : |
    %make_install PREFIX=%(installroot)/usr

    #Don't enable service files
    %install_file %(pkgdir)/opengamepadui-user.preset %(installroot)%(libdir)/systemd/user-preset/%(name).preset
