#
# SPDX-FileCopyrightText: Â© 2020-2023 Serpent OS Developers
#
# SPDX-License-Identifier: Zlib
#
name        : runc
version     : 1.1.5
release     : 4
homepage    : https://runc.io/
upstreams   :
    - https://github.com/opencontainers/runc/archive/refs/tags/v1.1.5.tar.gz : 76cbf30637cbb828794d72d32fb3fd6ff3139cd9743b8b44790fd110f43d96b2
summary     : CLI tool for managing OCI compliant containers
description : |
    CLI tool for managing OCI compliant containers
license     :
    - Apache-2.0
networking  : yes
builddeps   :
    - binary(go)
    - binary(go-md2man)
    - pkgconfig(libseccomp)
environment : |
    export GOPATH="`pwd`"
    export BUILDTAGS='seccomp'
    export GOFLAGS="-trimpath -mod=readonly -modcacherw"

    # Git SHA corresponding to the release tag
    export COMMIT=f19387a6bec4944c770f7668ab51c4348d9c2f38
    
    # https://github.com/serpent-os/boulder/issues/74
    export CGO_CFLAGS="${CFLAGS} -Wno-error=unused-command-line-argument"

    # https://github.com/serpent-os/boulder/issues/75
    export CGO_LDFLAGS="${CGO_LDFLAGS} -Wl,--no-gc-sections"
setup       : |
    mkdir -p src/github.com/opencontainers/runc
    find ./* -prune ! -name src -exec mv {} src/github.com/opencontainers/runc/ \;
build      : |
    cd src/github.com/opencontainers/runc
    %make runc man
install     : |
    cd src/github.com/opencontainers/runc/
    %install_bin runc

    %install_file contrib/completions/bash/runc -t %(installroot)/%(completionsdir)

    %install_dir %(installroot)/%(mandir)/man8
    %install_file man/man8/*.8 -t %(installroot)/%(mandir)/man8
tune        :
    - lto
    - optimize: speed
