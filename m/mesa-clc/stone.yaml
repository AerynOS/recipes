#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : mesa-clc
version     : 25.3.5
release     : 25
homepage    : https://mesa3d.org/
upstreams   :
    - https://mesa.freedesktop.org/archive/mesa-25.3.5.tar.xz : be472413475082df945e0f9be34f5af008baa03eb357e067ce5a611a2d44c44b
summary     : Tool used for building OpenCL C to SPIR-V
description : |
    %(name) tool used for building OpenCL C to SPIR-V
license     :
    - BSD-2-Clause
    - MIT
builddeps   :
    - binary(glslangValidator)
    - binary(llvm-config)
    - cmake(Clang)
    - pkgconfig(LLVMSPIRVLib)
    - pkgconfig(SPIRV-Tools)
    - pkgconfig(expat)
    - pkgconfig(libclc)
    - pkgconfig(libdrm)
    - python(mako)
    - python(pyyaml)
setup       : |
    # Fix build with glibc 2.43
    %patch %(pkgdir)/38594.patch
    %patch %(pkgdir)/0001-ftbfs-glibc-2.43.patch

    %meson \
        -Dgallium-drivers="" \
        -Dglx=disabled \
        -Dmesa-clc=enabled \
        -Dinstall-mesa-clc=true \
        -Dlibunwind=disabled \
        -Dplatforms="" \
        -Dvulkan-drivers="" \
        -Dzstd=disabled
build       : |
    %meson_build
install     : |
    %install_bin %(builddir)/src/compiler/clc/mesa_clc
    %install_bin %(builddir)/src/compiler/spirv/vtn_bindgen2
