From a57ef4cf77c9756b69d2651a9fec298a0aa388c7 Mon Sep 17 00:00:00 2001
From: Aster Boese <asterboese@mailbox.org>
Date: Tue, 29 Jul 2025 15:56:07 -0400
Subject: [PATCH 1/3] docs: add documentation for the distconfdir option

Signed-off-by: Aster Boese <asterboese@mailbox.org>
---
 docs/markdown/Builtin-options.md               | 1 +
 docs/markdown/Configuring-a-build-directory.md | 1 +
 tools/regenerate_docs.py                       | 3 ++-
 3 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/docs/markdown/Builtin-options.md b/docs/markdown/Builtin-options.md
index faf7a6088..ba4a05b7f 100644
--- a/docs/markdown/Builtin-options.md
+++ b/docs/markdown/Builtin-options.md
@@ -38,6 +38,7 @@ not be relied on, since they can be absolute paths in the following cases:
 | prefix                               | see below     | Installation prefix |
 | bindir                               | bin           | Executable directory |
 | datadir                              | share         | Data file directory |
+| distconfdir                          | config        | Distconf data directory |
 | includedir                           | include       | Header file directory |
 | infodir                              | share/info    | Info page directory |
 | libdir                               | see below     | Library directory |
diff --git a/docs/markdown/Configuring-a-build-directory.md b/docs/markdown/Configuring-a-build-directory.md
index 974b7ae99..76c21f30d 100644
--- a/docs/markdown/Configuring-a-build-directory.md
+++ b/docs/markdown/Configuring-a-build-directory.md
@@ -73,6 +73,7 @@ a sample output for a simple project.
       ------         -------------        -----------
       bindir         bin                  Executable directory
       datadir        share                Data file directory
+      distconfdir    config               Distconf data directory
       includedir     include              Header file directory
       infodir        share/info           Info page directory
       libdir         lib/x86_64-linux-gnu Library directory
diff --git a/tools/regenerate_docs.py b/tools/regenerate_docs.py
index b7484e765..f025379b1 100755
--- a/tools/regenerate_docs.py
+++ b/tools/regenerate_docs.py
@@ -92,7 +92,8 @@ def get_commands_data(root_dir: Path) -> T.Dict[str, T.Any]:
             'mandir',
             'sbindir',
             'sharedstatedir',
-            'sysconfdir'
+            'sysconfdir',
+            'distconfdir'
         ]
         out = text
         for a in args:
-- 
2.50.1


From f0e0532a34cdd74b8af506d47cabdc42e2024ed0 Mon Sep 17 00:00:00 2001
From: Aster Boese <asterboese@mailbox.org>
Date: Tue, 29 Jul 2025 15:55:47 -0400
Subject: [PATCH 2/3] tests: add tests for the distconfdir option

Signed-off-by: Aster Boese <asterboese@mailbox.org>
---
 test cases/unit/59 native file override/crossfile        | 1 +
 test cases/unit/59 native file override/meson.build      | 6 +++---
 .../unit/59 native file override/meson_options.txt       | 1 +
 test cases/unit/59 native file override/nativefile       | 1 +
 unittests/allplatformstests.py                           | 3 +++
 unittests/machinefiletests.py                            | 9 ++++++---
 6 files changed, 15 insertions(+), 6 deletions(-)

diff --git a/test cases/unit/59 native file override/crossfile b/test cases/unit/59 native file override/crossfile
index 9dc4fbcfc..a979f3c79 100644
--- a/test cases/unit/59 native file override/crossfile	
+++ b/test cases/unit/59 native file override/crossfile	
@@ -1,6 +1,7 @@
 [paths]
 bindir = 'binbar'
 datadir = 'databar'
+distconfdir = 'distconfdir'
 includedir = 'includebar'
 infodir = 'infobar'
 libdir = 'libbar'
diff --git a/test cases/unit/59 native file override/meson.build b/test cases/unit/59 native file override/meson.build
index 6ada560ff..b5721ecd6 100644
--- a/test cases/unit/59 native file override/meson.build	
+++ b/test cases/unit/59 native file override/meson.build	
@@ -1,8 +1,8 @@
 project('native file overrides')
 
-foreach o : ['bindir', 'datadir', 'includedir', 'infodir', 'libdir',
-             'libexecdir', 'localedir', 'localstatedir', 'mandir', 'prefix',
-             'sbindir', 'sharedstatedir', 'sysconfdir']
+foreach o : ['bindir', 'datadir', 'distconfdir', 'includedir', 'infodir',
+             'libdir', 'libexecdir', 'localedir', 'localstatedir', 'mandir',
+             'prefix', 'sbindir', 'sharedstatedir', 'sysconfdir']
   expected = get_option('def_' + o)
   actual = get_option(o)
   assert(expected == actual,
diff --git a/test cases/unit/59 native file override/meson_options.txt b/test cases/unit/59 native file override/meson_options.txt
index 4d2abf9c6..f35e22ed3 100644
--- a/test cases/unit/59 native file override/meson_options.txt	
+++ b/test cases/unit/59 native file override/meson_options.txt	
@@ -1,5 +1,6 @@
 option('def_bindir', type: 'string', value : 'binfoo',)
 option('def_datadir', type: 'string', value : 'datafoo',)
+option('def_distconfdir', type: 'string', value : 'distconffoo',)
 option('def_includedir', type: 'string', value : 'includefoo',)
 option('def_infodir', type: 'string', value : 'infofoo',)
 option('def_libdir', type: 'string', value : 'libfoo',)
diff --git a/test cases/unit/59 native file override/nativefile b/test cases/unit/59 native file override/nativefile
index a39072579..ee0712131 100644
--- a/test cases/unit/59 native file override/nativefile	
+++ b/test cases/unit/59 native file override/nativefile	
@@ -1,6 +1,7 @@
 [paths]
 bindir = 'binfoo'
 datadir = 'datafoo'
+distconfdir = 'distconffoo'
 includedir = 'includefoo'
 infodir = 'infofoo'
 libdir = 'libfoo'
diff --git a/unittests/allplatformstests.py b/unittests/allplatformstests.py
index 1678ba446..598980111 100644
--- a/unittests/allplatformstests.py
+++ b/unittests/allplatformstests.py
@@ -291,6 +291,7 @@ class AllPlatformTests(BasePlatformTests):
                      'sbindir': 'sbin',
                      'sharedstatedir': 'com',
                      'sysconfdir': 'etc',
+                     'distconfdir': 'config',
                      },
             '/usr': {'prefix': '/usr',
                      'bindir': 'bin',
@@ -304,6 +305,7 @@ class AllPlatformTests(BasePlatformTests):
                      'sbindir': 'sbin',
                      'sharedstatedir': '/var/lib',
                      'sysconfdir': '/etc',
+                     'distconfdir': 'config',
                      },
             '/usr/local': {'prefix': '/usr/local',
                            'bindir': 'bin',
@@ -317,6 +319,7 @@ class AllPlatformTests(BasePlatformTests):
                            'sbindir': 'sbin',
                            'sharedstatedir': '/var/local/lib',
                            'sysconfdir': 'etc',
+                           'distconfdir': 'config',
                            },
             # N.B. We don't check 'libdir' as it's platform dependent, see
             # default_libdir():
diff --git a/unittests/machinefiletests.py b/unittests/machinefiletests.py
index b2839e6b2..a9c83be2c 100644
--- a/unittests/machinefiletests.py
+++ b/unittests/machinefiletests.py
@@ -829,7 +829,8 @@ class CrossFileTests(BasePlatformTests):
                               '-Ddef_mandir=manbar',
                               '-Ddef_sbindir=sbinbar',
                               '-Ddef_sharedstatedir=sharedstatebar',
-                              '-Ddef_sysconfdir=sysconfbar'])
+                              '-Ddef_sysconfdir=sysconfbar',
+                              '-Ddef_distconfdir=distconfbar'])
 
     def test_cross_file_dirs_overridden(self):
         testcase = os.path.join(self.unit_test_dir, '59 native file override')
@@ -847,7 +848,8 @@ class CrossFileTests(BasePlatformTests):
                               '-Ddef_mandir=manbar',
                               '-Ddef_sbindir=sbinbar',
                               '-Ddef_sharedstatedir=sharedstatebar',
-                              '-Ddef_sysconfdir=sysconfbar'])
+                              '-Ddef_sysconfdir=sysconfbar',
+                              '-Ddef_distconfdir=distconfbar'])
 
     def test_cross_file_dirs_chain(self):
         # crossfile2 overrides crossfile overrides nativefile
@@ -867,7 +869,8 @@ class CrossFileTests(BasePlatformTests):
                               '-Ddef_mandir=manbar',
                               '-Ddef_sbindir=sbinbar',
                               '-Ddef_sharedstatedir=sharedstatebar',
-                              '-Ddef_sysconfdir=sysconfbar'])
+                              '-Ddef_sysconfdir=sysconfbar',
+                              '-Ddef_distconfdir=distconfbar'])
 
     def test_user_options(self):
         # This is just a touch test for cross file, since the implementation
-- 
2.50.1


From 8ba618b91e133acf867972e2467617e684759dee Mon Sep 17 00:00:00 2001
From: Aster Boese <asterboese@mailbox.org>
Date: Tue, 29 Jul 2025 15:54:24 -0400
Subject: [PATCH 3/3] Add distconfdir option

The distconfdir is the directory in which the distributor of the system
places configuration files. This defaults to /usr/config, but is overridden
by sysconfdir, where system-specific configuration files reside.

Signed-off-by: Aster Boese <asterboese@mailbox.org>
---
 data/macros.meson                 | 1 +
 data/shell-completions/bash/meson | 2 ++
 data/shell-completions/zsh/_meson | 1 +
 mesonbuild/options.py             | 3 +++
 mesonbuild/utils/universal.py     | 6 ++++++
 5 files changed, 13 insertions(+)

diff --git a/data/macros.meson b/data/macros.meson
index 597741092..897ab5606 100644
--- a/data/macros.meson
+++ b/data/macros.meson
@@ -14,6 +14,7 @@
         --sbindir=%{_sbindir} \
         --includedir=%{_includedir} \
         --datadir=%{_datadir} \
+        --distconfdir=%{_distconfdir}
         --mandir=%{_mandir} \
         --infodir=%{_infodir} \
         --localedir=%{_datadir}/locale \
diff --git a/data/shell-completions/bash/meson b/data/shell-completions/bash/meson
index 404369818..aba1ce3df 100644
--- a/data/shell-completions/bash/meson
+++ b/data/shell-completions/bash/meson
@@ -160,6 +160,7 @@ _meson_complete_filedir() {
     prefix |\
     bindir |\
     datadir |\
+    distconfdir |\
     includedir |\
     infodir |\
     libdir |\
@@ -228,6 +229,7 @@ _meson_common_setup_configure_longopts=(
   prefix
   bindir
   datadir
+  distconfdir
   includedir
   infodir
   libdir
diff --git a/data/shell-completions/zsh/_meson b/data/shell-completions/zsh/_meson
index 6507b6819..040c39ada 100644
--- a/data/shell-completions/zsh/_meson
+++ b/data/shell-completions/zsh/_meson
@@ -38,6 +38,7 @@ local -a __meson_common=(
   '--prefix=[installation prefix]: :_directories'
   '--bindir=[executable directory]: :_directories'
   '--datadir=[data file directory]: :_directories'
+  '--distconfdir==[distributor configuration directory]: :_directories'
   '--includedir=[header file directory]: :_directories'
   '--infodir=[info page directory]: :_directories'
   '--libdir=[library directory]: :_directories'
diff --git a/mesonbuild/options.py b/mesonbuild/options.py
index 78dafd8bc..a64904f08 100644
--- a/mesonbuild/options.py
+++ b/mesonbuild/options.py
@@ -18,6 +18,7 @@ from .mesonlib import (
     HoldableObject,
     default_prefix,
     default_datadir,
+    default_distconfdir,
     default_includedir,
     default_infodir,
     default_libdir,
@@ -71,6 +72,7 @@ _BUILTIN_NAMES = {
     'prefix',
     'bindir',
     'datadir',
+    'distconfdir',
     'includedir',
     'infodir',
     'libdir',
@@ -684,6 +686,7 @@ BUILTIN_DIR_OPTIONS: T.Mapping[OptionKey, AnyOptionType] = {
         UserStringOption('prefix', 'Installation prefix', default_prefix()),
         UserStringOption('bindir', 'Executable directory', 'bin'),
         UserStringOption('datadir', 'Data file directory', default_datadir()),
+        UserStringOption('distconfdir', 'Distconf data directory', default_distconfdir()),
         UserStringOption('includedir', 'Header file directory', default_includedir()),
         UserStringOption('infodir', 'Info page directory', default_infodir()),
         UserStringOption('libdir', 'Library directory', default_libdir()),
diff --git a/mesonbuild/utils/universal.py b/mesonbuild/utils/universal.py
index d165bf54d..508072c8f 100644
--- a/mesonbuild/utils/universal.py
+++ b/mesonbuild/utils/universal.py
@@ -88,6 +88,7 @@ __all__ = [
     'default_libexecdir',
     'default_prefix',
     'default_datadir',
+    'default_distconfdir',
     'default_includedir',
     'default_infodir',
     'default_localedir',
@@ -1054,6 +1055,10 @@ def default_datadir() -> str:
     return 'share'
 
 
+def default_distconfdir() -> str:
+    return 'config'
+
+
 def default_includedir() -> str:
     if is_haiku():
         return 'develop/headers'
@@ -2167,6 +2172,7 @@ _BUILTIN_NAMES = {
     'pkg_config_path',
     'cmake_prefix_path',
     'vsenv',
+    'distconfdir',
 }
 
 
-- 
2.50.1

