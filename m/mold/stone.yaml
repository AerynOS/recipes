#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : mold
version     : 2.40.1
release     : 9
summary     : A Modern Linker
license     : BSD-3-Clause
homepage    : https://github.com/rui314/mold
description : |
    mold is a faster drop-in replacement for existing Unix linkers.
upstreams   :
    - https://github.com/rui314/mold/archive/refs/tags/v2.40.1.tar.gz: d1ce09a69941f8158604c3edcc96c7178231e7dba2da66b20f5ef6e112c443b7
builddeps   :
    - pkgconfig(libblake3)
    - pkgconfig(libzstd)
    - pkgconfig(mimalloc)
    - pkgconfig(tbb)
    - pkgconfig(zlib)
    - mimalloc-static
setup       : |
    %patch %(pkgdir)/0001-Set-default-settings-for-compression-and-build.patch

    %cmake -DMOLD_LTO=ON \
           -DMOLD_MOSTLY_STATIC=OFF \
           -DMOLD_USE_SYSTEM_MIMALLOC=ON \
           -DMOLD_USE_SYSTEM_TBB=ON
build       : |
    %cmake_build
install     : |
    %cmake_install
tuning      :
    - icf: all
    - lto
    - nosemantic
    - symbolic
