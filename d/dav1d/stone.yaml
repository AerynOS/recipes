#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : dav1d
version     : 1.5.1
release     : 3
homepage    : https://code.videolan.org/videolan/dav1d
upstreams   :
    - https://code.videolan.org/videolan/dav1d/-/archive/1.5.1/dav1d-1.5.1.tar.bz2 : 4eddffd108f098e307b93c9da57b6125224dc5877b1b3d157b31be6ae8f1f093
    - https://code.videolan.org/videolan/dav1d-test-data/-/archive/1.5.1/dav1d-test-data-1.5.1.tar.gz :
        hash: e99c6309de09862a452f7926d00dc7b2baec33890b1b3b61b6907767e888ff12
        rename: dav1d-test-data.tar.gz
        unpack: false
summary     : AV1 decoder targeted to be small and fast
description : |
    dav1d is a new AV1 cross-platform Decoder, open-source, and focused on speed and correctness.
license     : BSD-2-Clause
builddeps   :
    - binary(nasm)
    - pkgconfig(libxxhash)
tuning      :
    - lto: full
setup       : |
    mkdir tests/dav1d-test-data
    bsdtar-static -xf %(sourcedir)/dav1d-test-data.tar.gz --strip-components=1 -C tests/dav1d-test-data
    %meson -Dtestdata_tests=true
build       : |
    %meson_build
install     : |
    %meson_install
check       : |
    # The dependency ordering for this is slightly broken, and this needs to be built before tests can run
    meson compile tests/checkasm -C %(builddir)

    %meson_test
packages    :
    - "lib%(name)":
        summary: Library files for dav1d
        description: |
            Library files for dav1d, the AV1 cross-platform Decoder
        paths:
            - /usr/lib/libdav1d.so.*
