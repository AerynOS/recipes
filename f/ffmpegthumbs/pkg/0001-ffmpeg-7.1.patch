From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Reilly Brogan <reilly@reillybrogan.com>
Date: Sat, 6 Sep 2025 16:38:59 -0500
Subject: [PATCH] ffmpeg 7.1

---
 CMakeLists.txt                     | 18 ++++++++++++------
 ffmpegthumbnailer.cpp              |  6 +++---
 ffmpegthumbnailer/moviedecoder.cpp |  6 +++---
 ffmpegthumbnailer/moviedecoder.h   | 10 +++++-----
 4 files changed, 23 insertions(+), 17 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f0ed541..47e27f8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -25,7 +25,13 @@ include(ECMDeprecationSettings)
 
 find_package(Qt6 ${QT_MIN_VERSION} CONFIG REQUIRED COMPONENTS Core Gui)
 find_package(KF6 ${KF_MIN_VERSION} REQUIRED COMPONENTS KIO Config)
-find_package(FFmpeg COMPONENTS AVCODEC AVFORMAT SWSCALE)
+# find_package(FFmpeg COMPONENTS AVCODEC AVFORMAT SWSCALE)
+find_package(PkgConfig)
+pkg_check_modules(libavutil REQUIRED IMPORTED_TARGET libavutil-7.1)
+pkg_check_modules(libavfilter REQUIRED IMPORTED_TARGET libavfilter-7.1)
+pkg_check_modules(libavformat REQUIRED IMPORTED_TARGET libavformat-7.1)
+pkg_check_modules(libavcodec REQUIRED IMPORTED_TARGET libavcodec-7.1)
+pkg_check_modules(libswscale REQUIRED IMPORTED_TARGET libswscale-7.1)
 
 include_directories(
     ${FFMPEG_INCLUDE_DIRS}
@@ -73,11 +79,11 @@ target_link_libraries(ffmpegthumbs
     KF6::KIOCore
     KF6::ConfigCore
     KF6::ConfigGui
-    ${AVUTIL_LIBRARIES}
-    ${AVFILTER_LIBRARIES}
-    ${AVFORMAT_LIBRARIES}
-    ${AVCODEC_LIBRARIES}
-    ${SWSCALE_LIBRARIES}
+    PkgConfig::libavutil
+    PkgConfig::libavfilter
+    PkgConfig::libavformat
+    PkgConfig::libavcodec
+    PkgConfig::libswscale
 )
 
 install(FILES ffmpegthumbnailersettings5.kcfg DESTINATION ${KDE_INSTALL_KCFGDIR})
diff --git a/ffmpegthumbnailer.cpp b/ffmpegthumbnailer.cpp
index 40bf1be..3734723 100644
--- a/ffmpegthumbnailer.cpp
+++ b/ffmpegthumbnailer.cpp
@@ -19,9 +19,9 @@
 #include <QSpinBox>
 
 extern "C" {
-#include <libavformat/avformat.h>
-#include <libavutil/dict.h>
-#include <libavutil/log.h>
+#include <ffmpeg-7.1/libavformat/avformat.h>
+#include <ffmpeg-7.1/libavutil/dict.h>
+#include <ffmpeg-7.1/libavutil/log.h>
 }
 
 namespace {
diff --git a/ffmpegthumbnailer/moviedecoder.cpp b/ffmpegthumbnailer/moviedecoder.cpp
index 39a7c00..952ceff 100644
--- a/ffmpegthumbnailer/moviedecoder.cpp
+++ b/ffmpegthumbnailer/moviedecoder.cpp
@@ -11,9 +11,9 @@
 #include <QFileInfo>
 
 extern "C" {
-#include <libswscale/swscale.h>
-#include <libavutil/display.h>
-#include <libavutil/imgutils.h>
+#include <ffmpeg-7.1/libswscale/swscale.h>
+#include <ffmpeg-7.1/libavutil/display.h>
+#include <ffmpeg-7.1/libavutil/imgutils.h>
 }
 
 using namespace std;
diff --git a/ffmpegthumbnailer/moviedecoder.h b/ffmpegthumbnailer/moviedecoder.h
index 81434f9..9e3d46b 100644
--- a/ffmpegthumbnailer/moviedecoder.h
+++ b/ffmpegthumbnailer/moviedecoder.h
@@ -12,11 +12,11 @@
 #include <QImageIOHandler>
 
 extern "C" {
-#include <libavcodec/avcodec.h>
-#include <libavformat/avformat.h>
-#include <libavfilter/avfilter.h>
-#include <libavfilter/buffersrc.h>
-#include <libavfilter/buffersink.h>
+#include <ffmpeg-7.1/libavcodec/avcodec.h>
+#include <ffmpeg-7.1/libavformat/avformat.h>
+#include <ffmpeg-7.1/libavfilter/avfilter.h>
+#include <ffmpeg-7.1/libavfilter/buffersrc.h>
+#include <ffmpeg-7.1/libavfilter/buffersink.h>
 }
 
 namespace ffmpegthumbnailer
