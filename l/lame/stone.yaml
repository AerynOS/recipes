#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : lame
version     : '3.100'
release     : 6
homepage    : https://lame.sourceforge.io/
upstreams   :
    - https://sourceforge.net/projects/lame/files/lame/3.100/lame-3.100.tar.gz/download :
        hash: ddfe36cab873794038ae2c1210557ad34857a4b6bdc515785d1da9e175b1da1e
        rename: lame.tar.gz
summary     : LAME is a high quality MPEG Audio Layer III (MP3) encoder
description : |
    LAME is a high quality MPEG Audio Layer III (MP3) encoder licensed under the LGPL.
license     :
    - LGPL-2.0-or-later
builddeps   :
    # TODO: Remove me once boulder fix https://github.com/AerynOS/os-tools/pull/678 is packaged
    - binary(bsdtar-static)
    - binary(nasm)
    - pkgconfig(ncursesw)
setup       : |
    # version script assignment of 'global' to symbol 'lame_init_old' failed: symbol not defined
    export LDFLAGS="${LDFLAGS} -Wl,--undefined-version"

    # Fix rpath without reconfiguring
    sed -i -e 's/^\(\s*hardcode_libdir_flag_spec\s*=\).*/\1/' configure

    %configure \
        --disable-rpath \
        --disable-static \
        --enable-nasm \
        --enable-expopt=full
build       : |
    %make
install     : |
    %make_install
packages    :
    - "%(name)-docs":
        paths:
            - /usr/share/doc
