#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : lm_sensors
version     : 3.6.2
release     : 5
homepage    : https://hwmon.wiki.kernel.org/lm_sensors
upstreams   :
    - https://github.com/hramrach/lm-sensors/archive/refs/tags/V3-6-2.tar.gz : c6a0587e565778a40d88891928bf8943f27d353f382d5b745a997d635978a8f0
summary     : User space hardware monitoring
description : |
    User-space support for the hardware monitoring drivers in the Linux kernel
license     :
    - GPL-2.0-or-later
    - LGPL-2.1-or-later
builddeps   :
    - binary(bison)
    - binary(flex)
    - binary(which)
environment : |
    export MAKE_ARGS="CC=$CC AR=$AR PREFIX=/usr LIBDIR=%(libdir) MANDIR=/usr/share/man BUILD_STATIC_LIB=0"
setup       : |
    %patch %(pkgdir)/0001-Allow-sysconfig-to-not-exist.patch
    %patch %(pkgdir)/0001-Stateless.patch
build       : |
    %make $MAKE_ARGS
install     : |
    %make_install $MAKE_ARGS

    mkdir -p %(installroot)/usr/lib/systemd/system/
    %install_file prog/init/{fancontrol,lm_sensors}.service -t %(installroot)/usr/lib/systemd/system/

    %install_dir %(installroot)%(vendordir)
    mv %(installroot)/etc/sensors3.conf %(installroot)%(vendordir)/sensors3.conf
    rmdir -v %(installroot)/etc/sensors.d \
             %(installroot)/etc
packages    :
    - "%(name)-libs":
        summary: "Library files for %(name)"
        description: |
            Library files for %(name), typically pulled in as a dependency of another package.
        paths:
            - /usr/lib/libsensors.so.*
