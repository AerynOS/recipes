#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : nushell
version     : 0.104.1
release     : 5
homepage    : https://www.nushell.sh/
upstreams   :
    - https://github.com/nushell/nushell/archive/refs/tags/0.104.1.tar.gz : 3dafca8bf892f5a2afaac1122a88a7eb7f22a0b62ef901f550173a11d5cbdf6e
summary     : A new type of shell
description : |
    Nu is a new type of shell, that combines the traditional Unix tools with modern languages.
    It's written in Rust and has a powerful set of core commands, as well as a rich set of plugins for extending its functionality.
license     : MIT
networking  : true
builddeps   :
    - binary(find)
    - pkgconfig(libcurl)
    - pkgconfig(libgit2)
    - pkgconfig(libssh2)
    - pkgconfig(libzstd)
    - pkgconfig(openssl)
    - pkgconfig(sqlite3)
environment : |
    # Force use of system libs
    export LIBGIT2_NO_VENDOR=1
    export LIBSSH2_SYS_USE_PKG_CONFIG=1
    export LIBSQLITE3_SYS_USE_PKG_CONFIG=1
    export ZSTD_SYS_USE_PKG_CONFIG=1
setup       : |
    %cargo_fetch
build       : |
    %cargo_build \
            --workspace \
            --features=stable
install     : |
    %cargo_install nu

    find %(cargo_target_dir) -name "nu_plugin*" -executable -maxdepth 1 \
        -exec install -vDm755 -t "%(installroot)%(bindir)" "{}" +

    # Example plugins, not needed
    rm -rfv %(installroot)%(bindir)/nu_plugin_example \
            %(installroot)%(bindir)/nu_plugin_custom_values \
            %(installroot)%(bindir)/nu_plugin_stress_internals
