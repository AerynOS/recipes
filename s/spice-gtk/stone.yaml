#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : spice-gtk
version     : "0.42"
release     : 1
homepage    : https://www.spice-space.org/download/gtk
upstreams   :
    - https://www.spice-space.org/download/gtk/spice-gtk-0.42.tar.xz :
        hash: 9380117f1811ad1faa1812cb6602479b6290d4a0d8cc442d44427f7f6c0e7a58
summary     : GTK client and libraries for SPICE remote desktop servers (gtk3 version)
description : |
    GTK client and libraries for SPICE remote desktop servers (gtk3 version)
license     : LGPL-2.1-or-later
builddeps   :
    - binary(gtkdoc-scan)
    - binary(msgfmt)
    - binary(pod2man)
    - pkgconfig(epoxy)
    - pkgconfig(gio-unix-2.0)
    - pkgconfig(gobject-introspection-1.0)
    - pkgconfig(gstreamer-1.0)
    - pkgconfig(gstreamer-app-1.0)
    - pkgconfig(gtk+-3.0)
    # - pkgconfig(libcacard)
    - pkgconfig(json-glib-1.0)
    - pkgconfig(libacl)
    - pkgconfig(libcap-ng)
    - pkgconfig(liblz4)
    # - pkgconfig(libphodav-2.0)
    # - pkgconfig(libphodav-3.0)
    - pkgconfig(libsasl2)
    #- pkgconfig(libsoup-2.4)
    - pkgconfig(libsoup-3.0)
    #- pkgconfig(libucontext)
    - pkgconfig(libturbojpeg)
    - pkgconfig(libusb-1.0)
    - pkgconfig(libusbredirhost)
    - pkgconfig(libusbredirparser-0.5)
    - pkgconfig(libva-x11)
    - pkgconfig(opus)
    - pkgconfig(polkit-gobject-1)
    - pkgconfig(spice-protocol)
    - pkgconfig(usbutils)
    - pkgconfig(vapigen)
    - pkgconfig(wayland-client)
    - pkgconfig(wayland-cursor)
    - pkgconfig(wayland-protocols)
    - pkgconfig(wayland-scanner)
    - pkgconfig(wayland-server)
    - pkgconfig(x11)
    - python(pyparsing)
    - python(six)
    - docbook-xsl
environment : |
    # Temporary, replace with boulder macro
    export XML_CATALOG_FILES="file:///usr/share/defaults/docbook/docbook-xsl/catalog"
setup       : |
    export LDFLAGS="${LDFLAGS} -Wl,--undefined-version"
    %meson \
        -Dusb-ids-path="%(datadir)/hwdata/usb.ids"
build       : |
    %meson_build
install     : |
    %meson_install
    chmod -c 4755 %(installroot)/%(libdir)/spice-gtk/spice-client-glib-usb-acl-helper

    # TODO: with capabilities spice-client-glib-usb-acl-helper needs CAP_FOWNER+EP
check       : |
    %meson_test
