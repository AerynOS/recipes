#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : svt-av1
version     : 3.1.0
release     : 4
homepage    : https://gitlab.com/AOMediaCodec/SVT-AV1
upstreams   :
    - https://gitlab.com/AOMediaCodec/SVT-AV1/-/archive/v3.1.0/SVT-AV1-v3.1.0.tar.bz2 : 8231b63ea6c50bae46a019908786ebfa2696e5743487270538f3c25fddfa215a
summary     : Scalable Video Technology for AV1 (SVT-AV1 Encoder)
description : |
    The Scalable Video Technology for AV1 (SVT-AV1 Encoder) is an AV1-compliant encoder library core.
license     :
    - AOMPL-1.0 # https://aomedia.org/license/patent-license/
    - BSD-2-Clause
# TODO: Vendor/package cpuinfo
networking  : true #For cpuinfo
builddeps   :
    - binary(nasm)
tuning      :
    - lto: full
setup      : |
    # Causes build failures like
    # error: always_inline function '_mm256_set1_epi32' requires target feature 'avx', but would be inlined into function 'svt_av1_calc_target_weighted_pred_above_avx2' that is compiled without support for 'avx'
    export CFLAGS="${CFLAGS/-Wa,--compress-debug-sections=zstd/}"

    %cmake \
           -DBUILD_APPS=OFF
build      : |
    %cmake_build
install    : |
    %cmake_install
