#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : scx-scheds
version     : 1.0.16
release     : 4
homepage    : https://github.com/sched-ext/scx
upstreams   :
    - https://github.com/sched-ext/scx/archive/refs/tags/v1.0.16.tar.gz : f788d95aa66dbd30744c062e23ac71e55209016f951f74de9a3b214b583d82ff
summary     : sched_ext schedulers and tools
description : |
    sched_ext schedulers and tools
networking  : yes
license     :
    - MIT
builddeps   :
    - binary(bpftool)
    - binary(cargo)
    - binary(make)
    - binary(jq)
    - binary(protoc)
    - pkgconfig(libbpf)
    - pkgconfig(libelf)
    - pkgconfig(libseccomp)
    - pkgconfig(libsystemd)
environment : |
    # sccache is currently broken with this build for unknown reasons. Disable it for now
    unset RUSTC_WRAPPER
setup       : |
    %meson \
        -Dbpftool=disabled \
        -Dlibbpf_a=disabled \
        -Dvendordir=%(vendordir)
    %cargo_fetch
build       : |
    %meson_build
install     : |
    %meson_install

    # Unsupported, use scx_loader
    rm -v %(installroot)%(libdir)/systemd/system/scx.service

    # Overwrite shipped default config with our own
    %install_file %(pkgdir)/config.toml %(installroot)%(vendordir)/scx_loader/config.toml
packages    :
    - "%(name)-devel":
        paths:
            - /usr/bin/vmlinux_docify
