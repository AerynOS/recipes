#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : scx-scheds
version     : 1.0.15
release     : 2
homepage    : https://github.com/sched-ext/scx
upstreams   :
    - https://github.com/sched-ext/scx/archive/refs/tags/v1.0.15.tar.gz : 1c2c4248747ea5556f536185a8dde5920dfab8a5961a30791dfe0878ad3d98a0
summary     : sched_ext schedulers and tools
description : |
    sched_ext schedulers and tools
networking  : yes
license     :
    - MIT
builddeps   :
    - binary(bpftool)
    - binary(cargo)
    - binary(make)
    - binary(jq)
    - binary(protoc)
    - pkgconfig(libbpf)
    - pkgconfig(libelf)
    - pkgconfig(libseccomp)
    - pkgconfig(libsystemd)
environment : |
    # sccache is currently broken with this build for unknown reasons. Disable it for now
    unset RUSTC_WRAPPER
setup       : |
    %meson \
        -Dbpftool=disabled \
        -Dlibbpf_a=disabled \
        -Dvendordir=%(vendordir)
    %cargo_fetch
build       : |
    %meson_build
install     : |
    %meson_install

    # Unsupported, use scx_loader
    rm -v %(installroot)%(libdir)/systemd/system/scx.service
packages    :
    - "%(name)-devel":
        paths:
            - /usr/bin/vmlinux_docify
