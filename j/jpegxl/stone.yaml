#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : jpegxl
version     : "0.11.2"
release     : 8
homepage    : https://github.com/libjxl/libjxl
upstreams   :
    - https://github.com/libjxl/libjxl/archive/refs/tags/v0.11.2.tar.gz : ab38928f7f6248e2a98cc184956021acb927b16a0dee71b4d260dc040a4320ea
    - git|https://github.com/webmproject/sjpeg.git : 94e0df6d0f8b44228de5be0ff35efb9f946a13c9
    - git|https://skia.googlesource.com/skcms.git : b2e692629c1fb19342517d7fb61f1cf83d075492
summary     : JPEG XL image format reference implementation
description : |
    JPEG XL image format reference implementation
license     : BSD-3-Clause
builddeps   :
    - binary(asciidoc)
    - binary(doxygen)
    - binary(sphinx-build)
    - pkgconfig(OpenEXR)
    - pkgconfig(gl)
    - pkgconfig(glut)
    - pkgconfig(lcms2)
    - pkgconfig(libbrotlidec)
    - pkgconfig(libhwy)
    - pkgconfig(libjpeg)
    - pkgconfig(libpng)
    - pkgconfig(zlib)
    - docbook
    - giflib-devel
    # gimp-2.0
    # NOTE: Do not re-enable pixbuf loader. It is now superceded by a glycin plugin
environment : |
    %export_docbook_catalogs
setup       : |
    rm -rf third_party/{sjpeg,skcms}
    ln -s ../../sjpeg.git third_party/sjpeg
    ln -s ../../skcms.git third_party/skcms

    %cmake \
        -DBUILD_TESTING=OFF \
        -DJPEGXL_ENABLE_BENCHMARK=OFF \
        -DJPEGXL_ENABLE_PLUGINS=ON \
        -DJPEGXL_ENABLE_PLUGIN_MIME=ON \
        -DJPEGXL_ENABLE_PLUGIN_GDKPIXBUF=OFF
build       : |
    %cmake_build
install     : |
    %cmake_install

    %install_dir %(installroot)%(docdir)/jxl-pixbuf-loader
    echo "DEPRECATED" > %(installroot)%(docdir)/jxl-pixbuf-loader/README
tuning      :
    - optimize: speed
packages    :
    - "libjxl":
        summary: Library files for JPEG-XL
        description: Library files for JPEG-XL
        paths:
            - /usr/lib/libjxl*.so.*
            - /usr/share/mime/packages/image-jxl.xml

    - "libjxl-devel":
        summary: Library files for JPEG-XL - Development headers
        description: Library files for JPEG-XL - Development headers
        rundeps:
            - "libjxl"
        paths:
            - /usr/include/jxl/
            - /usr/lib/pkgconfig/libjxl*.pc
            - /usr/lib/libjxl*.a
            - /usr/lib/libjxl*.so
    
    - "jxl-pixbuf-loader":
        summary: JPEG-XL image loader for GTK+ applications
        description: JPEG-XL image loader for GTK+ applications
        paths:
            - /usr/share/doc/jxl-pixbuf-loader/README
    
    - "libjxl-utils":
        summary: Utilities for manipulating JPEG XL images
        description: Utilities for manipulating JPEG XL images
        paths:
            - /usr/bin/cjxl
            - /usr/bin/djxl
            - /usr/bin/jxlinfo
            - /usr/share/man/man1/cjxl.1*
            - /usr/share/man/man1/djxl.1*
# TODO: enable tests
