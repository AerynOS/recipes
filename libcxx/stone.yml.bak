name        : libcxx
version     : 12.0.0
release     : 1
summary     : LLVM's libcxx
license     :
    - Apache-2.0 WITH LLVM-exception
    - NCSA
homepage    : https://www.llvm.org
description : |
    LLVM's libcxx
upstreams   :
    - https://github.com/llvm/llvm-project/releases/download/llvmorg-12.0.0/llvm-project-12.0.0.src.tar.xz : 9ed1688943a4402d7c904cc4515798cdb20080066efa010fe7e1f2551b423628
install     : |
    # This is a bit hacky till there's an export for all build stages
    export llvmopts="
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DLLVM_ENABLE_PROJECTS='libcxx;libcxxabi;libunwind;pstl' \
        -DLLVM_LIBDIR_SUFFIX=%(libsuffix) \
        -DLLVM_BUILD_32_BITS=OFF \
        -DLIBCXX_INSTALL_SUPPORT_HEADERS=ON \
        -DLLVM_USE_SANITIZER=OFF \
        -DLLVM_ENABLE_UNWIND_TABLES=ON \
        -DLLVM_INCLUDE_BENCHMARKS=OFF \
        -DLLVM_INCLUDE_TESTS=OFF \
        -DLLVM_INCLUDE_UTILS=OFF \
        -DLLVM_BUILD_TOOLS=OFF \
        -DLIBCXX_ENABLE_PARALLEL_ALGORITHMS=ON \
        -DLIBCXX_ENABLE_SHARED=ON \
        -DLIBCXX_ENABLE_STATIC=ON \
        -DLIBCXX_ENABLE_STATIC_ABI_LIBRARY=ON \
        -DLIBCXX_HAS_ATOMIC_LIB=ON \
        -DLIBCXX_STATICALLY_LINK_ABI_IN_STATIC_LIBRARY=ON \
        -DLIBCXX_USE_COMPILER_RT=ON \
        -DLIBCXXABI_ENABLE_SHARED=OFF \
        -DLIBCXXABI_ENABLE_STATIC_UNWINDER=ON \
        -DLIBCXXABI_INSTALL_LIBRARY=OFF \
        -DLIBCXXABI_STATICALLY_LINK_UNWINDER_IN_SHARED_LIBRARY=ON \
        -DLIBCXXABI_STATICALLY_LINK_UNWINDER_IN_STATIC_LIBRARY=ON \
        -DLIBCXXABI_USE_COMPILER_RT=ON \
        -DLIBCXXABI_USE_LLVM_UNWINDER=ON \
        -DLIBUNWIND_ENABLE_SHARED=OFF \
        -DLIBUNWIND_ENABLE_STATIC=ON \
        -DLIBUNWIND_INSTALL_LIBRARY=OFF \
        -DLIBUNWIND_USE_COMPILER_RT=ON"

    cd llvm
    %cmake ${llvmopts} \
        -DLLVM_BUILD_LLVM_DYLIB=ON \
        -DLLVM_LINK_LLVM_DYLIB=ON
    cd ..

    %cmake_build cxx cxxabi unwind

    DESTDIR="%(installroot)" %cmake_build install-cxx
emul32      : true
toolchain   : gnu
