#
# SPDX-FileCopyrightText: Â© 2020-2025 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : vscode-bin
version     : "1.109.4"
release     : 22
upstreams   :
    - https://vscode.download.prss.microsoft.com/dbazure/download/stable/c3a26841a84f20dfe0850d0a5a9bd01da4f003ea/code-stable-x64-1771257373.tar.gz:
        hash: eb39ae625df840c1b75b987f8027e25bd6ad2b80a9768409bedb70eb2e2ccbd4

    - https://raw.githubusercontent.com/microsoft/vscode/1.109.4/resources/linux/code.desktop:
        hash: 2f1782b30c4e040efff655fd9cf477930c5a0c81ddae27749b0cbb922c1d248e
        unpack: false

    - https://raw.githubusercontent.com/microsoft/vscode/1.109.4/resources/linux/code-url-handler.desktop:
        hash: c361efa7e02fcad759ed80d2fbab67877f33219b981578af6fffaf18aeb12d9b
        unpack: false

    - https://raw.githubusercontent.com/microsoft/vscode/1.109.4/resources/linux/code-workspace.xml:
        hash: 3af748dd6578a1775e8eb7248ba397b7e11840df2ea6ee234ff76fee3dc306cf
        unpack: false
homepage    : https://code.visualstudio.com/
license     : Distributable
summary     : Visual Studio Code (vscode) - Editor for building and debugging modern web and cloud applications (official binary version)
description : |
    Visual Studio Code (vscode) - Editor for building and debugging modern web and cloud applications (official binary version)
rundeps     :
    - ca-certificates
    - binary(git)
 # Causes extension signature validation to fail
debug       : false
strip       : false
environment : |
    function meta_info() {
        sed 's/@@NAME_LONG@@/Visual Studio Code/g' "$1" |\
        sed 's/@@NAME_SHORT@@/Code/g' |\
        sed 's/@@NAME@@/code/g' |\
        sed 's#@@EXEC@@#/usr/bin/code#g' |\
        sed 's/@@ICON@@/visual-studio-code/g' |\
        sed 's/@@URLPROTOCOL@@/vscode/g'
    }
install     : |
    export vsdir=%(libdir)/vscode
    %install_dir %(installroot)/$vsdir
    cp -R %(workdir)/* %(installroot)/$vsdir/

    %install_exe %(pkgdir)/vscode.sh %(installroot)%(bindir)/code

    meta_info %(sourcedir)/code.desktop \
        | %install_file /dev/stdin "%(installroot)/usr/share/applications/code.desktop"
    meta_info %(sourcedir)/code-url-handler.desktop \
        | %install_file /dev/stdin "%(installroot)/usr/share/applications/code-url-handler.desktop"
    meta_info %(sourcedir)/code-workspace.xml \
        | %install_file /dev/stdin "%(installroot)/usr/share/mime/packages/code-workspace.xml"

    %install_file %(pkgdir)/vscode.svg %(installroot)/usr/share/icons/hicolor/scalable/apps/visual-studio-code.svg

    %install_dir %(installroot)%(bashcompletionsdir) %(installroot)%(zshcompletionsdir)
    ln -srv %(installroot)${vsdir}/resources/completions/bash/code %(installroot)%(bashcompletionsdir)/code
    ln -srv %(installroot)${vsdir}/resources/completions/zsh/_code %(installroot)%(zshcompletionsdir)/_code
