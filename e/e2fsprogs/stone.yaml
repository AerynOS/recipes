#
# SPDX-FileCopyrightText: Â© 2020-2024 Serpent OS Developers
#
# SPDX-License-Identifier: MPL-2.0
#
name        : e2fsprogs
version     : '1.47.3'
release     : 6
homepage    : https://e2fsprogs.sourceforge.net 
upstreams   :
    - https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v1.47.3/e2fsprogs-1.47.3.tar.xz : 857e6ef800feaa2bb4578fbc810214be5d3c88b072ea53c5384733a965737329
summary     : Filesystem utilities for ext2/3/4 filesystems
description : |
    Filesystem utilities for ext2/3/4 filesystems
license     :
    - BSD-3-Clause
builddeps   :
    # Needed for /usr/share/info file generation
    - binary(info)
    - binary(msgmerge)
    - binary(gzip)
    - pkgconfig(blkid)
    - pkgconfig(fuse3)
    - pkgconfig(libacl)
    - pkgconfig(libarchive)
    - pkgconfig(libattr)
    - pkgconfig(libmagic)
    - pkgconfig(libsystemd)
    - pkgconfig(libudev)
    - pkgconfig(uuid)
setup       : |
    %patch %(pkgdir)/stateless.patch

    # Doesn't detect uutils mkdir correctly, so force that
    %configure \
        --with-root-prefix=%(prefix) \
        --enable-elf-shlibs \
        --enable-nls \
        --enable-symlink-install \
        --disable-libuuid \
        --disable-libblkid \
        --disable-fsck \
        MKDIR_P="/usr/bin/mkdir -p"
build       : |
    %make
install     : |
    %make_install
    # remove static libs
    rm -vf %(installroot)%(libdir)/libcom_err.a
    rm -vf %(installroot)%(libdir)/libe2p.a
    rm -vf %(installroot)%(libdir)/libext2fs.a
    rm -vf %(installroot)%(libdir)/libss.a
packages    :
    - "%(name)-libs":
        paths:
            - /usr/lib/libe2p.so.*
            - /usr/lib/libext2fs.so.*

    - "libcom_err":
        summary: Common error description library
        description: Common error description library
        paths:
            - /usr/lib/libcom_err.so.*

    - "libcom_err-devel":
        summary: Common error description library - devel files
        description: Common error description library - devel files
        rundeps:
             - libcom_err
        paths:
            - /usr/bin/compile_et
            - /usr/include/et/
            - /usr/include/com_err.h
            - /usr/lib/libcom_err.so
            - /usr/lib/pkgconfig/com_err.pc
            - /usr/share/et/
            - /usr/share/man/man1/compile_et.1*
            - /usr/share/man/man3/com_err.3*

    - "libss":
        summary: Command line interface parsing library
        description: Command line interface parsing library
        paths:
            - /usr/lib/libss.so.*

    - "libss-devel":
        summary: Command line interface parsing library - devel files
        description: Command line interface parsing library - devel files
        rundeps:
            - libss
        paths:
            - /usr/bin/mk_cmds
            - /usr/include/ss/
            - /usr/lib/libss.so
            - /usr/lib/pkgconfig/ss.pc
            - /usr/share/ss/
            - /usr/share/man/man1/mk_cmds.1*

    - "e2scrub":
        summary: Online Ext4 metadata consistency checking tool and service
        description: Online Ext4 metadata consistency checking tool and service
        rundeps:
            - "%(name)"
            - lvm2
            - systemd
        paths:
            - /usr/sbin/e2scrub*
            - /usr/share/man/man8/e2scrub*
            - /usr/lib/e2fsprogs/e2fsprogs/e2scrub_fail
            - /usr/lib/systemd/system
            - /usr/lib/udev/rules.d/96-e2scrub.rules
